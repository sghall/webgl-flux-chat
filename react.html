<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <link rel="stylesheet" type="text/css" href="css/app.css">
  </head>
  <body>
    <div id="react"></div>
    <script src="bower_components/react/react.js"></script>
    <script src="bower_components/threejs/build/three.js"></script>
    <script src="bower_components/d3/d3.js"></script>
    <script src="bower_components/tweenjs/build/tween.min.js"></script>
    <script src="../subunit/dist/subunit.js"></script>
    <script src="traceur/traceur.js"></script>
    <script src="traceur/bootstrap.js"></script>
    <script type="module">
      import { MessageComposer } from './js/views/MessageComposer.react';
      import { exampleData } from './data/exampleData';
      import { serverActions } from './js/actions/serverActions';
      import { messagesView } from './js/views/messagesView';
      import { spheresView } from './js/views/spheresView';
      import { scene, camera, renderer } from './js/scene';

      exampleData.init(); // load example data into localstorage

      var rawMessages = JSON.parse(localStorage.getItem('messages'));
      serverActions.receiveAll(rawMessages);

      React.render(
        React.createElement(MessageComposer, null),
        document.getElementById('react')
      );

      window.addEventListener('resize', onWindowResize, false);

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
      }

      function animate() {
        TWEEN.update();
        spheresView.root.node().rotation.y += 0.02;

        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }

      animate();
    </script>
  </body>
</html>